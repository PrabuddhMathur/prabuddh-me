{% load static wagtailcore_tags wagtailimages_tags %}

<!-- Navigation Header -->
<nav id="main-navbar" class="bg-base-100 border-b border-base-200 {% if settings.core.HeaderSettings.header_style == 'sticky' %}sticky top-0 z-50 transition-transform duration-300{% endif %}">
    <div class="max-w-7xl mx-auto px-6 lg:px-12 py-4 flex items-center justify-between">
        <!-- Logo / Site Title -->
        <a href="/" class="text-lg font-semibold tracking-tight hover:text-base-content/70 transition-colors">
            {% if settings.core.HeaderSettings.show_logo and settings.core.HeaderSettings.logo %}
                {% image settings.core.HeaderSettings.logo fill-32x32 class="inline-block" %}
            {% else %}
                {{ settings.core.HeaderSettings.site_title }}
            {% endif %}
        </a>
        
        <!-- Desktop Navigation Links -->
        <div class="hidden lg:flex items-center gap-8">
            {% for link in settings.core.HeaderSettings.get_navigation_links %}
            <a href="{{ link.url }}" class="text-sm font-medium hover:text-base-content transition-colors {% if request.path == link.url %}text-base-content border-b-2 border-base-content pb-1{% else %}text-base-content/90{% endif %}">
                {{ link.text }}
            </a>
            {% endfor %}
        </div>
        
        <!-- Right Side Actions -->
        <div class="flex items-center gap-2">
            <!-- Search Bar -->
            {% if settings.core.HeaderSettings.show_search %}
            <form action="/search/" method="get" class="hidden md:block">
                <input type="text" name="q" placeholder="Search..." class="input input-sm input-bordered w-40 focus:w-56 transition-all" aria-label="Search" />
            </form>
            {% endif %}
            
            <!-- Theme Toggle Button -->
            {% if settings.core.HeaderSettings.show_theme_toggle %}
            {% include "core/components/theme-toggle-button.html" %}
            {% endif %}
            
            <!-- Mobile Menu Button -->
            <div class="lg:hidden">
                {% include "core/components/mobile-menu.html" with nav_links=settings.core.HeaderSettings.get_navigation_links %}
            </div>
        </div>
    </div>
</nav>

{% if settings.core.HeaderSettings.header_style == 'sticky' %}
<script>
    // Hide/show navbar on scroll
    (function() {
        const navbar = document.getElementById('main-navbar');
        if (!navbar) return;
        
        let lastScrollTop = 0;
        let isScrolling = false;
        
        window.addEventListener('scroll', function() {
            if (!isScrolling) {
                window.requestAnimationFrame(function() {
                    const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                    
                    // Don't hide navbar at the very top of the page
                    if (currentScroll <= 100) {
                        navbar.style.transform = 'translateY(0)';
                    } 
                    // Scrolling down - hide navbar
                    else if (currentScroll > lastScrollTop && currentScroll > 100) {
                        navbar.style.transform = 'translateY(-100%)';
                    } 
                    // Scrolling up - show navbar
                    else if (currentScroll < lastScrollTop) {
                        navbar.style.transform = 'translateY(0)';
                    }
                    
                    lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                    isScrolling = false;
                });
                
                isScrolling = true;
            }
        }, { passive: true });
    })();
</script>
{% endif %}
