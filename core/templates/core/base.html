{% load static wagtailcore_tags wagtailuserbar tailwind_tags %}

<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    {% include "core/includes/seo_meta.html" %}
    
    <!-- Google Fonts: Hedvig Letters Family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hedvig+Letters+Serif:opsz,wght@12..24,400;12..24,500;12..24,700&family=Hedvig+Letters+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Theme initialization script (must run before body renders to prevent flash) -->
    <script>
        // Initialize theme from localStorage or default to light (ignore system preference)
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    <title>{% block title %}{% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}{% endblock %}</title>
    
    {# Tailwind CSS - Use compiled version for production, dev tag for local development #}
    {% if DEBUG %}
        {% tailwind_css %}
    {% else %}
        <link rel="stylesheet" href="{% static 'css/dist/styles.css' %}">
    {% endif %}
    
    {# Spoiler feature CSS (used in rich text blocks) #}
    <link rel="stylesheet" href="{% static 'core/css/spoiler.css' %}">
    
    {# Mobile header hide-on-scroll CSS #}
    <link rel="stylesheet" href="{% static 'core/css/mobile-header-scroll.css' %}">
    
    {# Custom CSS #}
    {% block extra_css %}{% endblock %}
    
    <style>
        body {
            font-family: "Hedvig Letters Serif", ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-base-100">
    {% wagtailuserbar %}
    
    {# Header #}
    {% block header %}
        {% include "core/includes/header.html" %}
    {% endblock %}
    
    {# Main Content #}
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>
    
    {# Footer #}
    {% block footer %}
        {% include "core/includes/footer.html" %}
    {% endblock %}
    
    {# Theme Toggle JavaScript #}
    <script>
        // Theme toggle functionality
        (function() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            
            if (!themeToggle) return; // Exit if toggle button doesn't exist
            
            // Function to update icon based on current theme
            function updateThemeIcon(theme) {
                if (theme === 'dim') {
                    themeIconLight.classList.add('hidden');
                    themeIconDark.classList.remove('hidden');
                } else {
                    themeIconLight.classList.remove('hidden');
                    themeIconDark.classList.add('hidden');
                }
            }
            
            // Initialize icon based on current theme
            const currentTheme = localStorage.getItem('theme') || 'light';
            updateThemeIcon(currentTheme);
            
            // Toggle theme on button click
            themeToggle.addEventListener('click', function() {
                const html = document.documentElement;
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dim' : 'light';
                
                // Update theme
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });
        })();
    </script>
    
    {# Spoiler feature JavaScript (used in rich text blocks) #}
    <script src="{% static 'core/js/spoiler.js' %}" defer></script>
    
    {# Mobile header hide-on-scroll JavaScript #}
    <script src="{% static 'core/js/mobile-header-scroll.js' %}" defer></script>
    
    {# Extra JavaScript #}
    {% block extra_js %}{% endblock %}
</body>
</html>
